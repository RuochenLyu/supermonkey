{"ast":null,"code":"var __jsx = React.createElement;\nimport React from \"react\";\nimport fetch from \"isomorphic-unfetch\";\nimport \"../styles/reset.scss\";\nimport \"../styles/global.scss\";\nimport style from \"../styles/layout.scss\";\nimport Loading from \"../components/loading\";\nimport Head from \"../components/head\";\nimport CityPicker from \"../components/city-picker\";\nimport BoxList from \"../components/box-list\";\nimport Schedule from \"../components/schedule\";\n\nclass Index extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleBoxIdChange = this.handleBoxIdChange.bind(this);\n    this.handleCurrentCityChange = this.handleCurrentCityChange.bind(this);\n    this.state = {\n      loading: true\n    };\n  }\n\n  handleBoxIdChange(boxId) {\n    this.setState({\n      boxId\n    });\n    localStorage.setItem(\"sm/boxId\", boxId);\n  }\n\n  handleCurrentCityChange(currentCity) {\n    this.fetch(currentCity);\n  }\n\n  componentDidMount() {\n    const currentCity = localStorage.getItem(\"sm/currentCity\") || \"北京市\";\n    this.fetch(currentCity);\n  }\n\n  async fetch(currentCity) {\n    this.setState({\n      loading: true\n    });\n    const result = await fetch(`/static/${currentCity}.json`);\n    const json = await result.json();\n    console.log(json.data);\n    let boxId = localStorage.getItem(\"sm/boxId\") * 1;\n    const {\n      cityMap\n    } = json.data.main.boxArea;\n    const {\n      boxList\n    } = cityMap[currentCity][0];\n\n    if (boxList.every(item => item.boxId !== boxId)) {\n      boxId = boxList[0].boxId;\n    }\n\n    this.setState({\n      loading: false,\n      data: json.data,\n      boxId,\n      currentCity\n    });\n    localStorage.setItem(\"sm/boxId\", boxId);\n    localStorage.setItem(\"sm/currentCity\", currentCity);\n  }\n\n  render() {\n    const {\n      loading\n    } = this.state;\n    if (loading) return __jsx(Loading, null);\n    const {\n      data,\n      boxId,\n      currentCity\n    } = this.state;\n    const {\n      cityList\n    } = data.main.boxArea;\n    return __jsx(\"div\", {\n      className: style.main\n    }, __jsx(Head, {\n      title: \"\\u8D85\\u7EA7\\u7329\\u7329\\xB7\\u8BFE\\u7A0B\\u8868\",\n      description: \"\\u8D85\\u7EA7\\u7329\\u7329\\u5065\\u8EAB\\u5728\\u7EBF\\u8BFE\\u7A0B\\u8868\",\n      url: \"https://super.kshift.me\"\n    }), __jsx(\"nav\", null, __jsx(CityPicker, {\n      cityList: cityList,\n      currentCity: currentCity,\n      onCurrentCityChange: this.handleCurrentCityChange\n    }), __jsx(BoxList, {\n      data: data,\n      boxId: boxId,\n      currentCity: currentCity,\n      onBoxIdChange: this.handleBoxIdChange\n    })), __jsx(Schedule, {\n      data: data,\n      boxId: boxId\n    }));\n  }\n\n}\n\nexport default Index;","map":null,"metadata":{},"sourceType":"module"}