{"ast":null,"code":"var _jsxFileName = \"/Users/ruochen/Documents/workspace/supermonkey/pages/index.js\";\nvar __jsx = React.createElement;\nimport React from \"react\";\nimport fetch from \"isomorphic-unfetch\";\nimport \"../styles/reset.scss\";\nimport \"../styles/global.scss\";\nimport style from \"../styles/layout.scss\";\nimport Loading from \"../components/loading\";\nimport Head from \"../components/head\";\nimport CityPicker from \"../components/city-picker\";\nimport BoxList from \"../components/box-list\";\nimport Schedule from \"../components/schedule\";\n\nclass Index extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleBoxIdChange = this.handleBoxIdChange.bind(this);\n    this.handleCurrentCityChange = this.handleCurrentCityChange.bind(this);\n    this.state = {\n      loading: true\n    };\n  }\n\n  handleBoxIdChange(boxId) {\n    this.setState({\n      boxId\n    });\n    localStorage.setItem(\"sm/boxId\", boxId);\n  }\n\n  handleCurrentCityChange(currentCity) {// this.setState({ currentCity });\n    // localStorage.setItem(\"sm/currentCity\", currentCity);\n  }\n\n  componentDidMount() {\n    const currentCity = localStorage.getItem(\"sm/currentCity\") || \"北京市\";\n    this.fetch(currentCity);\n  }\n\n  async fetch(currentCity) {\n    this.setState({\n      loading: true\n    });\n    const result = await fetch(`/static/${currentCity}.json`);\n    const json = await result.json();\n    console.log(json.data);\n    let boxId = localStorage.getItem(\"sm/boxId\") * 1;\n    const {\n      cityMap\n    } = json.data.main.boxArea;\n    const {\n      boxList\n    } = cityMap[currentCity][0];\n\n    if (boxList.every(item => item.boxId !== boxId)) {\n      boxId = boxList[0].boxId;\n    }\n\n    this.setState({\n      loading: false,\n      data: json.data,\n      boxId,\n      currentCity\n    });\n    localStorage.setItem(\"sm/boxId\", boxId);\n    localStorage.setItem(\"sm/currentCity\", currentCity);\n  }\n\n  render() {\n    const {\n      loading\n    } = this.state;\n    if (loading) return __jsx(Loading, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 62\n      },\n      __self: this\n    });\n    const {\n      data,\n      boxId,\n      currentCity\n    } = this.state;\n    const {\n      cityList\n    } = data.main.boxArea;\n    return __jsx(\"div\", {\n      className: style.main,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 68\n      },\n      __self: this\n    }, __jsx(Head, {\n      title: \"\\u8D85\\u7EA7\\u7329\\u7329\\xB7\\u8BFE\\u7A0B\\u8868\",\n      description: \"\\u8D85\\u7EA7\\u7329\\u7329\\u5065\\u8EAB\\u5728\\u7EBF\\u8BFE\\u7A0B\\u8868\",\n      url: \"https://super.kshift.me\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 69\n      },\n      __self: this\n    }), __jsx(\"nav\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74\n      },\n      __self: this\n    }, __jsx(CityPicker, {\n      cityList: cityList,\n      currentCity: currentCity,\n      onCurrentCityChange: this.handleCurrentCityChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75\n      },\n      __self: this\n    }), __jsx(BoxList, {\n      data: data,\n      boxId: boxId,\n      currentCity: currentCity,\n      onBoxIdChange: this.handleBoxIdChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80\n      },\n      __self: this\n    })), __jsx(Schedule, {\n      data: data,\n      boxId: boxId,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default Index;","map":{"version":3,"sources":["/Users/ruochen/Documents/workspace/supermonkey/pages/index.js"],"names":["React","fetch","style","Loading","Head","CityPicker","BoxList","Schedule","Index","Component","constructor","props","handleBoxIdChange","bind","handleCurrentCityChange","state","loading","boxId","setState","localStorage","setItem","currentCity","componentDidMount","getItem","result","json","console","log","data","cityMap","main","boxArea","boxList","every","item","render","cityList"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport fetch from \"isomorphic-unfetch\";\nimport \"../styles/reset.scss\";\nimport \"../styles/global.scss\";\nimport style from \"../styles/layout.scss\";\n\nimport Loading from \"../components/loading\";\nimport Head from \"../components/head\";\nimport CityPicker from \"../components/city-picker\";\nimport BoxList from \"../components/box-list\";\nimport Schedule from \"../components/schedule\";\n\nclass Index extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleBoxIdChange = this.handleBoxIdChange.bind(this);\n    this.handleCurrentCityChange = this.handleCurrentCityChange.bind(this);\n    this.state = { loading: true };\n  }\n\n  handleBoxIdChange(boxId) {\n    this.setState({ boxId });\n    localStorage.setItem(\"sm/boxId\", boxId);\n  }\n\n  handleCurrentCityChange(currentCity) {\n    // this.setState({ currentCity });\n    // localStorage.setItem(\"sm/currentCity\", currentCity);\n  }\n\n  componentDidMount() {\n    const currentCity = localStorage.getItem(\"sm/currentCity\") || \"北京市\";\n    this.fetch(currentCity);\n  }\n\n  async fetch(currentCity) {\n    this.setState({ loading: true });\n    const result = await fetch(`/static/${currentCity}.json`);\n    const json = await result.json();\n    console.log(json.data);\n\n    let boxId = localStorage.getItem(\"sm/boxId\") * 1;\n    const { cityMap } = json.data.main.boxArea;\n    const { boxList } = cityMap[currentCity][0];\n\n    if (boxList.every(item => item.boxId !== boxId)) {\n      boxId = boxList[0].boxId;\n    }\n\n    this.setState({\n      loading: false,\n      data: json.data,\n      boxId,\n      currentCity,\n    });\n    localStorage.setItem(\"sm/boxId\", boxId);\n    localStorage.setItem(\"sm/currentCity\", currentCity);\n  }\n\n  render() {\n    const { loading } = this.state;\n    if (loading) return <Loading />;\n\n    const { data, boxId, currentCity } = this.state;\n    const { cityList } = data.main.boxArea;\n\n    return (\n      <div className={style.main}>\n        <Head\n          title=\"超级猩猩·课程表\"\n          description=\"超级猩猩健身在线课程表\"\n          url=\"https://super.kshift.me\"\n        />\n        <nav>\n          <CityPicker\n            cityList={cityList}\n            currentCity={currentCity}\n            onCurrentCityChange={this.handleCurrentCityChange}\n          />\n          <BoxList\n            data={data}\n            boxId={boxId}\n            currentCity={currentCity}\n            onBoxIdChange={this.handleBoxIdChange}\n          />\n        </nav>\n        <Schedule data={data} boxId={boxId} />\n      </div>\n    );\n  }\n}\n\nexport default Index;\n"]},"metadata":{},"sourceType":"module"}